============================================================================================================================================V2
USE EDI:

--数据源表加S_前缀
--临时表加T_前缀
--结果表加R_前缀
--需跨DB的表加M_前缀
--然后hive表都以项目简写前缀，如EDI_XX

--1.EDI_S_PROD_DATA --deleted


--2.EDI_M_PROD_INFO --DELETED
CREATE TABLE IF NOT EXISTS EDI_M_PROD_INFO (
 CRAWL_DATE STRING COMMENT '爬取时间',
 SOURCE STRING COMMENT '数据来源，如JD.COM，TMALL.COM',
 PROD_ID STRING COMMENT '商品ID',
 NAME STRING COMMENT '商品销售名',
 PRICE FLOAT,
 BRAND STRING COMMENT '品牌',
 MODEL STRING COMMENT '型号',
 COLOR STRING,
 CAPACITY STRING,
 SCREEN_SIZE STRING,
 COMM_AMOUNT INT COMMENT '累计评价,如果不能爬到就先空，计算时自己统计',
 COMM_GOOD_AMOUNT INT COMMENT '好评率 PRAISE RATE 与描述相符||好评度，存4位整数，2120 = 21.20%',
 COMM_BAD_AMOUNT INT COMMENT '差评，存4位整数，2120 = 21.20%',
 COMM_MIDDLE_AMOUNT INT COMMENT '中评',
 HOT_TAGS STRING COMMENT '商品热点标签',
 PARAMS STRING COMMENT '规格参数')
COMMENT '商品基本信息表，内部表，以写入当天日期分区存储（如20151107）'
PARTITIONED BY (PT_DATE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;


--3.EDI_M_PROD_COMMS
--LOAD DATA LOCAL INPATH '/opt/running/edi/data/prod_comms.txt' INTO TABLE EDI_M_PROD_COMMS PARTITION (PT_DATE='`date '+%Y-%m-%d'`');
CREATE TABLE IF NOT EXISTS EDI_M_PROD_COMMS (
 CRAWL_DATE STRING COMMENT '爬取时间',
 ID STRING COMMENT '评论ID',
 PARENT_ID STRING COMMENT '父ID,本表自循环，关联ID',
 PROD_ID STRING COMMENT '评论所属商品ID',
 COMM_INFO STRING COMMENT '评论内容',
 COMM_TIME STRING COMMENT '买家评论时间',
 PROD_INFO STRING COMMENT '该评论针对的购买信息',
 PUBLISHER_INFO STRING COMMENT '评论发布人信息',
 COMM_TAGS STRING COMMENT '评论标签',
 COMM_PRAISE_AMOUNT INT COMMENT '评论被赞数量',
 COMM_REPLY_AMOUNT STRING COMMENT '评论回复')
COMMENT '商品评论表，内部表，以写入当天日期分区存储（如20151107）'
PARTITIONED BY (PT_DATE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;



--4.EDI_R_COMM_TAG,该表数据量最大
--select A.arr[0],A.arr[1],A.arr[2],A.arr[3] from (SELECT explode(OPUDF(COMM_INFO,PROD_INFO)) as arr FROM EDI_PROD_COMMENTS ) A;
--LOAD DATA LOCAL INPATH '~/tmp/hive/' INTO TABLE EDI_R_COMM_TAG PARTITION (PT_DATE='`date '+%Y-%m-%d'`');
--ALTER TABLE table_name PARTITION (dt='2008-08-08') RENAME TO PARTITION (dt='20080808');
CREATE TABLE IF NOT EXISTS EDI_R_COMM_TAG (
 COMM_ID STRING COMMENT '评论ID',
 ASPECT STRING COMMENT '评价纬度',
 ATTR STRING,
 CATEGORY INT COMMENT '评价得分',
 CONTEXT_INDEX STRING COMMENT '上下文 观点句位置（START,END）')
COMMENT '评论标签表，从不同纬度评价该条评论的结果数据'
PARTITIONED BY (PT_DATE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;


--[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2][INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2]
--5.EDI_M_R_AMOUNT
CREATE TABLE IF NOT EXISTS EDI_M_R_AMOUNT (
 BRAND STRING COMMENT '品牌',
 MODEL STRING COMMENT '型号',
 ASPECT STRING COMMENT '评价纬度',
 ATTR STRING,
 CATEGORY_VAL INT COMMENT '评价得分值',
 AMOUNT INT COMMENT 'sum总数'
 ) COMMENT '评论标签汇总'
PARTITIONED BY (PT_DATE STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;

-------------------------------------------------------------------
MYSQL:

--1.m_r_amount
CREATE TABLE IF NOT EXISTS M_R_AMOUNT1 (
 BRAND VARCHAR(200) COMMENT '品牌',
 MODEL VARCHAR(200) COMMENT '型号',
 ASPECT VARCHAR(200) COMMENT '评价纬度',
 ATTR VARCHAR(200),
 CATEGORY_VAL VARCHAR(200) COMMENT '评价得分值',
 AMOUNT VARCHAR(200) COMMENT 'sum总数',
 CREATED_DT VARCHAR(200)
) COMMENT '商品标签表，对同一商品从不同纬度的评价';

CREATE TABLE T_M_R_AMOUNT AS SELECT BRAND,MODEL,ASPECT,ATTR,CATEGORY_VAL,AMOUNT FROM M_R_AMOUNT LIMIT 0;
 
--2.m_prod_comms
CREATE TABLE IF NOT EXISTS M_PROD_COMMS (
 CRAWL_DATE VARCHAR(200) COMMENT '爬取时间',
 ID VARCHAR(200) COMMENT '评论ID',
 PARENT_ID VARCHAR(200) COMMENT '父ID,本表自循环，关联ID',
 PROD_ID VARCHAR(200) COMMENT '评论所属商品ID',
 COMM_INFO TEXT COMMENT '评论内容',
 COMM_TIME VARCHAR(200) COMMENT '买家评论时间',
 COMM_TAGS VARCHAR(1000) COMMENT '评论标签',
 COMM_REPLY_AMOUNT TEXT COMMENT '评论回复',
 COMM_PRAISE_COUNT INT COMMENT '评论被赞数量',
 PUBLISHER_INFO VARCHAR(200) COMMENT '评论发布人信息',
 PROD_INFO VARCHAR(1000) COMMENT '该评论针对的购买信息',
 CREATED_DT VARCHAR(200)
) COMMENT '商品评论表，内部表，以写入当天日期分区存储（如20151107）';


--3.m_prod_info
CREATE TABLE IF NOT EXISTS M_PROD_INFO (
 CRAWL_DATE VARCHAR(1000) COMMENT '爬取时间',
 SOURCE VARCHAR(1000) COMMENT '数据来源，如JD.COM，TMALL.COM',
 PROD_ID VARCHAR(200) COMMENT '商品ID',
 NAME VARCHAR(1000) COMMENT '商品销售名',
 PRICE FLOAT,
 BRAND VARCHAR(200) COMMENT '品牌',
 MODEL VARCHAR(200) COMMENT '型号',
 COLOR VARCHAR(200),
 CAPACITY VARCHAR(200),
 SCREEN_SIZE VARCHAR(200),
 COMM_AMOUNT INT COMMENT '累计评价,如果不能爬到就先空，计算时自己统计',
 COMM_GOOD_AMOUNT INT COMMENT '好评率 PRAISE RATE 与描述相符||好评度，存4位整数，2120 = 21.20%',
 COMM_BAD_AMOUNT INT COMMENT '差评，存4位整数，2120 = 21.20%',
 COMM_MIDDLE_AMOUNT INT COMMENT '中评',
 CREATED_DT VARCHAR(200)
) COMMENT '商品基本信息表，内部表，以写入当天日期分区存储（如20151107）';